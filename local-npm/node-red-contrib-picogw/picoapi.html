<script type="text/javascript">
    RED.nodes.registerType('call picogw',{
        category: 'advanced',
        color: '#ffaaaa',
        defaults: {
            name: {value:""}
            ,resource: {value:"",required:true}
            ,polling: {value:""}
            ,args_for_poll: {value:""}
        },
        inputs:1,
        inputLabels:'GET or PUT (with value) request',
        outputs:1,
        outputLabels:['published or GET/PUT reply'],
        icon: "picon.png",
        align: "left",
        label: function() {
            return this.name||"call picogw";
        }
    });
</script>

<script type="text/x-red" data-template-name="call picogw">
    <div class="form-row">
        <label for="node-input-name"><i class="icon-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Node title">
    </div>
    <div class="form-row">
        <label for="node-input-resource"><i class="icon-tag"></i> Resource</label>
        <input type="text" id="node-input-resource" placeholder="/v1/..">
    </div>
    <div class="form-row">
        <label for="node-input-polling"><i class="icon-tag"></i> Polling interval</label>
        <input type="text" id="node-input-polling" placeholder="interval in seconds (0 means disabled)">
    </div>
    <div class="form-row">
        <label for="node-input-args_for_poll"><i class="icon-tag"></i> Arguments</label>
        <input type="text" id="node-input-args_for_poll" placeholder="Optional arguments for polling">
    </div>
</script>

<script type="text/x-red" data-help-name="call picogw">
    <p>PicoGWのWebSocket APIを呼び出す</p>
    <p>
        今のところポートはlocalhost:8080固定です。<br />
        <p>入力も出力もオプションです。出力だけの場合、publishを受け取るようになります。pollingが1以上（分単位）の場合は定期的に値をGETしに行きます。この場合はsubscribeしないのでpublishは受け取りません。</p>
        <p>入力はJSONオブジェクトで、methodメンバーが必須です(通常はGETまたはPUT)。argsがオプションです（API次第です）</p>
        <p>もし入力にreqidメンバーがあると、出力にもそのまま出されます。内部では使われません。</p>

        <p>出力はJSONオブジェクトです。reqidメンバーがある場合はGETやPUTの結果であり、そうでない場合は自発的にPublishされたものです。</p>
        <hr />
        PicoGWはECHOENT Lite対応、神奈川工科大学発のホームサーバーです。
        関連情報は<a href="http://pico.peatix.com/">こちらから</a>。
    </p>
</script>
