#!/usr/bin/env node
const childProcess = require('child_process');

// Sometimes, npm i -g target directory is missing from module search path.
// So set this script module path as current path.

let pi = __filename.lastIndexOf('node_modules');
let pathstr;
if( pi == -1 ){
	pathstr = require('path').dirname(__filename);
} else {
	pathstr = __filename.substring( 0,pi )+'node_modules';
}

// Also, find picogw module from the globally installed picogw location.

let sysDir = childProcess.execSync('npm root -g');
sysDir = (sysDir+'').trim();


try {
	let argv = [sysDir+'/picogw/main.js'].concat(process.argv);
	const child = childProcess.spawn('node',argv,{cwd:pathstr});
	child.on('exit',function(code){
		if( code == 99 ){
			console.log('PicoGW was exited without rebooting.');
			child.stop();
			process.exit();
		}
	})
} catch(e){
	console.error('\u001b[31mPlease install PicoGW globally!\u001b[0m');
}
