#!/bin/bash

__filename="$(readlink -f "$0")"
pathstr="$(cd "$(dirname "$__filename")" && pwd)"

# Set the current path as the script module path
pi=${pathstr##*node_modules}
pi=$((${#pathstr} - ${#pi}))
if [ $pi -eq 0 ]; then
  pathstr=$pathstr/node_modules
else
  pathstr=${pathstr:0:$pi}
fi

# Also, find picogw module from the globally installed picogw location
sysDir=$(npm root -g | tr -d '\n')

# Check if picogw is installed globally
if [ -z "$sysDir" ]; then
  echo -e "\e[31mPlease install PicoGW globally!\e[0m"
  exit 1
fi

# Run picogw
cd $pathstr
node "$sysDir/picogw/main.js" "${@:1:($#)}"
